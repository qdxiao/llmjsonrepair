# llmjsonrepair

[English](#english) | [ä¸­æ–‡](#ä¸­æ–‡)

---

## ä¸­æ–‡

ä¸“é—¨ç”¨äºä¿®å¤å¤§æ¨¡å‹è¾“å‡º JSON æ ¼å¼é”™è¯¯çš„ Go è¯­è¨€åº“

### ç®€ä»‹

`llmjsonrepair` æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Go è¯­è¨€åº“ï¼Œä¸“é—¨ç”¨äºä¿®å¤å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¾“å‡ºçš„ä¸å®Œæ•´æˆ–æ ¼å¼é”™è¯¯çš„ JSON æ•°æ®ã€‚å½“ LLM ç”Ÿæˆçš„ JSON å› ä¸ºå„ç§åŸå› ï¼ˆå¦‚è¾“å‡ºæˆªæ–­ã€æ ¼å¼é”™è¯¯ã€ç¼ºå°‘å¼•å·ç­‰ï¼‰æ— æ³•æ­£å¸¸è§£ææ—¶ï¼Œè¿™ä¸ªåº“å¯ä»¥æ™ºèƒ½åœ°ä¿®å¤è¿™äº›é—®é¢˜ã€‚

### ç‰¹æ€§

- ğŸ”§ **æ™ºèƒ½ä¿®å¤**: è‡ªåŠ¨ä¿®å¤å„ç§ JSON æ ¼å¼é”™è¯¯
- ğŸ¯ **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: åŸºäºè§£æä¸Šä¸‹æ–‡æ™ºèƒ½æ¨æ–­ç¼ºå¤±çš„ç»“æ„
- ğŸš€ **é«˜å®¹é”™æ€§**: å¤„ç†æ·±åº¦åµŒå¥—ã€æ··åˆæ ¼å¼ç­‰å¤æ‚æƒ…å†µ
- ğŸ“¦ **ç®€å•æ˜“ç”¨**: æä¾›ç®€æ´çš„ API æ¥å£
- ğŸ”„ **å¤šå¯¹è±¡æ”¯æŒ**: æ”¯æŒå¤„ç†è¿ç»­çš„ JSON å¯¹è±¡æµ
- ğŸ§  **LLM å‹å¥½**: ä¸“é—¨é’ˆå¯¹å¤§æ¨¡å‹è¾“å‡ºç‰¹ç‚¹è®¾è®¡

### æ”¯æŒä¿®å¤çš„é—®é¢˜ç±»å‹

- âœ… ç¼ºå°‘ç»“å°¾æ‹¬å·/æ–¹æ‹¬å·
- âœ… å¯¹è±¡é”®ç¼ºå°‘å¼•å·
- âœ… å­—ç¬¦ä¸²æœªæ­£ç¡®é—­åˆ
- âœ… æ·±åº¦åµŒå¥—ç»“æ„é”™è¯¯
- âœ… æ··ä¹±çš„å¼•å·å’Œè½¬ä¹‰å­—ç¬¦
- âœ… å¤š JSON å¯¹è±¡æµè¢«æˆªæ–­
- âœ… ç¼ºå°‘åˆ†éš”ç¬¦ï¼ˆé€—å·ã€å†’å·ï¼‰
- âœ… LLM æ€è€ƒè¿‡ç¨‹æ–‡æœ¬æ®‹ç•™

### å®‰è£…

```bash
go get github.com/qdxiao/llmjsonrepair
```

### å¿«é€Ÿå¼€å§‹

```go
package main

import (
    "fmt"
    "log"
    "github.com/qdxiao/llmjsonrepair/pkg"
)

func main() {
    // ç¤ºä¾‹ï¼šä¿®å¤ç¼ºå°‘ç»“å°¾æ‹¬å·çš„ JSON
    malformedJSON := `{"name": "John", "age": 30, "skills": ["Go", "Python"`
    
    // æ–¹æ³•1: ä¿®å¤å¹¶è¿”å›æ ¼å¼åŒ–çš„ JSON å­—ç¬¦ä¸²
    repairedJSON, err := pkg.Repair(malformedJSON)
    if err != nil {
        log.Fatal(err)
    }
    fmt.Println("ä¿®å¤åçš„ JSON:")
    fmt.Println(repairedJSON)
    
    // æ–¹æ³•2: ä¿®å¤å¹¶è¿”å›è§£æåçš„æ•°æ®ç»“æ„
    data, err := pkg.Loads(malformedJSON)
    if err != nil {
        log.Fatal(err)
    }
    fmt.Printf("è§£æåçš„æ•°æ®: %+v\n", data)
}
```

### API æ–‡æ¡£

#### `Repair(jsonStr string) (string, error)`

ä¿®å¤ JSON å­—ç¬¦ä¸²å¹¶è¿”å›æ ¼å¼åŒ–çš„ JSON å­—ç¬¦ä¸²ã€‚

**å‚æ•°:**
- `jsonStr`: éœ€è¦ä¿®å¤çš„ JSON å­—ç¬¦ä¸²

**è¿”å›:**
- `string`: ä¿®å¤å¹¶æ ¼å¼åŒ–åçš„ JSON å­—ç¬¦ä¸²
- `error`: é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœä¿®å¤å¤±è´¥ï¼‰

#### `Loads(jsonStr string) (interface{}, error)`

ä¿®å¤ JSON å­—ç¬¦ä¸²å¹¶è¿”å›è§£æåçš„æ•°æ®ç»“æ„ã€‚

**å‚æ•°:**
- `jsonStr`: éœ€è¦ä¿®å¤çš„ JSON å­—ç¬¦ä¸²

**è¿”å›:**
- `interface{}`: è§£æåçš„æ•°æ®ç»“æ„ï¼ˆ`map[string]interface{}` æˆ– `[]interface{}`ï¼‰
- `error`: é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœä¿®å¤å¤±è´¥ï¼‰

### ä½¿ç”¨ç¤ºä¾‹

æŸ¥çœ‹ `example/main.go` æ–‡ä»¶è·å–æ›´å¤šè¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹ï¼ŒåŒ…æ‹¬å„ç§é”™è¯¯ç±»å‹çš„ä¿®å¤æ¼”ç¤ºã€‚

### è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### è®¸å¯è¯

MIT License

---

## English

A Go library specifically designed to repair malformed JSON output from Large Language Models (LLMs)

### Introduction

`llmjsonrepair` is a powerful Go library designed to fix incomplete or malformed JSON data output by Large Language Models (LLMs). When JSON generated by LLMs cannot be parsed normally due to various reasons (such as output truncation, format errors, missing quotes, etc.), this library can intelligently repair these issues.

### Features

- ğŸ”§ **Smart Repair**: Automatically fixes various JSON format errors
- ğŸ¯ **Context Aware**: Intelligently infers missing structures based on parsing context
- ğŸš€ **High Fault Tolerance**: Handles complex situations like deep nesting and mixed formats
- ğŸ“¦ **Easy to Use**: Provides clean API interfaces
- ğŸ”„ **Multi-Object Support**: Supports processing continuous JSON object streams
- ğŸ§  **LLM Friendly**: Specifically designed for LLM output characteristics

### Supported Error Types

- âœ… Missing closing brackets/braces
- âœ… Object keys without quotes
- âœ… Unclosed strings
- âœ… Deep nested structure errors
- âœ… Messy quotes and escape characters
- âœ… Truncated multi-JSON object streams
- âœ… Missing separators (commas, colons)
- âœ… Residual LLM reasoning text

### Installation

```bash
go get github.com/qdxiao/llmjsonrepair
```

### Quick Start

```go
package main

import (
    "fmt"
    "log"
    "github.com/qdxiao/llmjsonrepair/pkg"
)

func main() {
    // Example: Fix JSON with missing closing bracket
    malformedJSON := `{"name": "John", "age": 30, "skills": ["Go", "Python"`
    
    // Method 1: Repair and return formatted JSON string
    repairedJSON, err := pkg.Repair(malformedJSON)
    if err != nil {
        log.Fatal(err)
    }
    fmt.Println("Repaired JSON:")
    fmt.Println(repairedJSON)
    
    // Method 2: Repair and return parsed data structure
    data, err := pkg.Loads(malformedJSON)
    if err != nil {
        log.Fatal(err)
    }
    fmt.Printf("Parsed data: %+v\n", data)
}
```

### API Documentation

#### `Repair(jsonStr string) (string, error)`

Repairs a JSON string and returns a formatted JSON string.

**Parameters:**
- `jsonStr`: The JSON string to be repaired

**Returns:**
- `string`: The repaired and formatted JSON string
- `error`: Error information (if repair fails)

#### `Loads(jsonStr string) (interface{}, error)`

Repairs a JSON string and returns the parsed data structure.

**Parameters:**
- `jsonStr`: The JSON string to be repaired

**Returns:**
- `interface{}`: The parsed data structure (`map[string]interface{}` or `[]interface{}`)
- `error`: Error information (if repair fails)

### Examples

See the `example/main.go` file for more detailed usage examples, including demonstrations of repairing various error types.

### Contributing

Issues and Pull Requests are welcome!

### License

MIT License
